Развертывание на сервере
========================

Подразумевается использование ZEO. Если ZEO-сервер еще не поднят,
то это нужно сделать, см. ``zeo-server.txt``

Само же приложение в единственном или множественном числе развертывается
как WSGI-прилжение, использующее ZEO-клиент.

1. Нужно воздерживаться от использования веток из системы контроля
   версий, пусть бы и распределенной. При отметке нового релиз-тэга
   создается архив и загружается на продакшн-сервер, на чистое место.

   При использовании GitHub можно брать wget'ом автоматически создаваемые
   архивы релизов по известному URL'у. При распаковке из архива код будет
   лежать как bbru-1.x.x, т.е. версию сразу видно.

2. При этом предыдущий код (инстанс) еще продолжает работать.

3. После распаковки необходимо собрать WSGI-приложение с ZEO-клиентом:

     $ python bootstrap.py

     $ bin/buildout -c deploy.cfg

4. В сгенерированном файле etc/site.zcml есть директива (вернее 2
   директивы), декларирующая существование глобального пользователя
   с абсолютными правами. Она закомментирована специально для того,
   чтобы не не включать ее случайно, с предопределенными логином и
   паролем. Для того чтобы использовать на продакшн-сайте глобоального
   суперпользователя, нужно явно раскомментировать директиву и указать
   логин и пароль.

   Необходимо отметить, что для развертывания в dev-режиме (см.
   `install-dev.rst`) файл etc/site.zcml генерируется несколько другой
   (как и zope.conf), и в нем системный пользователь с абсолютными правами
   незакомментирован, так что используется разработчиком постоянно.

5. Предварительно прогнав тесты, запустить приложение в режиме UNIX демона:

     $ bin/test

     $ bin/paster serve --daemon deploy.ini

6. Остановить предыдущую версию приложения и удалить ее (rm -r). Поскольку
   используется ZEO-клиент, то никакой ценной информации там нет. За исключением
   логов, но они есть и в полном варианте у ZEO-сервера.

Другие опции команды bin/paster serve
+++++++++++++++++++++++++++++++++++++

Осведомиться о состоянии процесса:

  $ bin/paster serve --status deploy.ini

Остановить демонизированный процесс:

  $ bin/paster serve --stop-daemon

С другими опциями можно ознакомиться в встроенной справке:

  $ bin/paster serve --help
